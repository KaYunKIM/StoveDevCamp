# API 명세서

#### 프로세스

1. 해당 토픽에 대해 피드 조회를 처음 요청하면 클라이언트에서 서버로 해당 토픽의 트윗 정보 조회 요청(GET)
서버에서는 해당 토픽의 최신 20개 트윗을 프론트로 전달
프론트에서는 이 트윗에서 가장 마지막 트윗의 id(bottomId) 저장

1. 스크롤이 내려가며 마지막 트윗 다음 20개 요청
클라이언트에서 가장 마지막 트윗의 id(bottomId)를 보내어 요청
→ 서버에서는 db에서 bottomId 다음 순서의 20개 조회하여 제공
→ N개의 트윗을 제공할 때 마다 가장 마지막 트윗의 id를 클라이언트 메모리에 저장.
→ 스크롤이 내려가서 추가 제공할 때, 가장 마지막 트윗의 id 보다 큰 것 중 20개 가져오고 다시 마지막 트윗의 id를 저장.

1. websocket 연결이 성공하면 클라이언트에서 서버로 현재 피드 트윗의 topId 전달함
서버에서는 db에서 가장 위 20개만큼 조회하여 제공
→가장 위(최신) 트윗의 Topid를 서버 메모리에 저장. ( → 신규 트윗에 활용)
→가장 아래(마지막) 트윗의 bottomId를 클라이언트에 저장.  ( → 스크롤 바 조회에 활용)

1. 첫 연결  후 3초 단위로 서버에서 신규 트윗을 조회하여 클라이언트로 전송 
(웹소켓)
→ 새로운 트윗이 없으면 전송하지 않고, 있으면 조회한 트윗 전부 전송
→ 신규 트윗의 여부는 서버에 저장된 해당 웹소켓의 가장 최신 트윗의 id 변수보다 큰 값을 조건으로 걸어서 가져옴
→ 가져온 트윗의 맨 위 트윗의 topid를 다시 서버 메모리에 저장.

cf) 최신 트윗 웹소켓, 과거 트윗 api 호출 → 전부 트윗 ID값 활용 조회

프론트 전송 요청

```plain text
tweetSocket.onopen = function(e) {
    tweetSocket.send(JSON.stringify({
        "topId": [topid값]
    }));
};
```

![API-명세서-image-0](images/API-명세서-image-0.png)

